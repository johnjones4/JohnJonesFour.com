---
layout: post
title:  "Large Uploads with Objective-C and NodeJS"
description: "In an app I'm building right now, I needed to be able to upload several large files to a NodeJS server application. To achieve this, I turned to an Objective-C library named ASIHTTPRequest</a>."
---

<p>In an app I'm building right now, I needed to be able to upload several large files to a NodeJS server application. To achieve this, I turned to an Objective-C library named <a href="http://allseeing-i.com/ASIHTTPRequest/" target="_blank">ASIHTTPRequest</a>. That library contains a class named <code>ASIFormDataRequest</code> that supports POSTing a file durectly to a URL without loading the file into an app's memory space. This has a huge advantage in apps because RAM space is always limited.</p>

<p>This first code example is the simplified upload logic. Assumed is that there is a <code>@property NSArray</code> of <code>NSURLs</code> named <code>videoFiles</code> that contains the files to upload, a <code>@property BOOL</code> named <code>continueUploading</code> that will stop the uploads, and a selector named <code>- (void)finishUploads</code>.</p>

<div data-gist-id="5db6e3adb0390cf7d8d9" data-gist-file="upload.m"></div>

<p>On the server side, I'm using <a href="http://expressjs.com/" target="_blank">Express</a> as middleware and processing the upload using <a href="https://github.com/expressjs/multer" target="_blank">Multer</a>. The server code below does not contain any validation logic and just uploads the file directly to Amazon S3.; I reccomend adding some validation code to verify the individual uploading the file has authority to do so. Also note that I'm passing the file to S3 using a readable stream rather than reading the file directly into a variable. This also helps control memory usage.</p>

<div data-gist-id="5db6e3adb0390cf7d8d9" data-gist-file="server.js"></div>

<p>For reference, here is the <code>config.json</code> file that the above code references:</p>

<div data-gist-id="5db6e3adb0390cf7d8d9" data-gist-file="config.json"></div>